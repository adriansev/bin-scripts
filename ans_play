#!/usr/bin/env bash

pushd "${HOME}/ansible/playbooks" &> /dev/null

ARG1="${1}"

ansible_inventory=$(ansible-inventory --list | jq -r '.["_meta"]["hostvars"] | keys[]')

if [[ -n "${ARG1}" ]]; then
    [[ "${ARG1}" == -* ]] || IS_HOST="$(echo ${ansible_inventory} | grep ${ARG1})"
fi

if [[ -n "${IS_HOST}" ]]; then
  TGT_SPEC="-e target=${ARG1}"
  shift
fi

ansible-playbook ${TGT_SPEC} "${@}"

popd &> /dev/null

